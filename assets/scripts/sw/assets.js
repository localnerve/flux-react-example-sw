/***
 * Copyright (c) 2015 Alex Grant (@localnerve), LocalNerve LLC
 * Copyrights licensed under the BSD License. See the accompanying LICENSE file for terms.
 *
 * Precaching and route installs for non-project (cdn) assets.
 * The 'data' module is generated by the build.
 */
/* global Request */
'use strict';

var toolbox = require('sw-toolbox');
var data = require('./data');
var urlm = require('../../../utils/urls');

/**
 * Install route handlers for cdn requests and precache assets. 
 */
function setupAssetRequests () {
  var next, hostname;

  toolbox.precache(
    data.assets
    .sort()
    .map(function (asset) {
      next = urlm.getHostname(asset);
      if (hostname !== next) {
        hostname = next;
        // New hostname, so install GET handler for that host
        toolbox.router.get('*', toolbox.networkFirst, {
          origin: hostname
        });
      }

      // Precache the asset in 'install'
      return new Request(asset, {
        mode: 'no-cors'
      });
    })
  );
}

module.exports = {
  setupAssetRequests: setupAssetRequests
};
